<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stika 3a - Upprifjun Pro</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React og ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Canvas Confetti Library (fyrir fagnaðarlæti) -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Leturgerð -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f0f4f8;
            -webkit-tap-highlight-color: transparent;
        }
        .animate-pop {
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .streak-fire {
            animation: burn 0.5s alternate infinite;
        }
        @keyframes burn {
            from { transform: scale(1); filter: drop-shadow(0 0 2px orange); }
            to { transform: scale(1.1); filter: drop-shadow(0 0 5px red); }
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICONS ---
        const Icons = {
            Hash: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg>,
            Calculator: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="14"/><line x1="16" y1="18" x2="16" y2="18"/><line x1="12" y1="14" x2="12" y2="14"/><line x1="12" y1="18" x2="12" y2="18"/><line x1="8" y1="14" x2="8" y2="14"/><line x1="8" y1="18" x2="8" y2="18"/></svg>,
            Thermometer: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/></svg>,
            LayoutList: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="14" width="7" height="7" /><rect x="3" y="3" width="7" height="7" /><line x1="14" y1="4" x2="21" y2="4" /><line x1="14" y1="9" x2="21" y2="9" /><line x1="14" y1="15" x2="21" y2="15" /><line x1="14" y1="20" x2="21" y2="20" /></svg>,
            ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            RefreshCcw: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg>,
            CheckCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            XCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>,
            Award: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>,
            BookOpen: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            Flame: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.6-3.3.31.81.9 1.8 2.9 2.8z"/></svg>
        };

        // --- GÖGN ---
        const categories = [
          {
            id: 'saetiskerfi',
            title: 'Sætiskerfi og Tölur',
            icon: <Icons.Hash />,
            color: 'bg-indigo-600',
            textColor: 'text-indigo-600',
            bgLight: 'bg-indigo-50',
            borderColor: 'border-indigo-200',
            description: 'Tölustafir, sætisgildi, tugabrot og upplausn talna.',
            questions: [
              {
                id: '1a',
                question: 'Hvað táknar tölustafurinn 8 í tölunni 483?',
                options: ['8', '80', '800', '3'],
                correctAnswer: '80',
                explanation: '8 er í tugasæti, svo gildið er 8 tugir eða 80.'
              },
              {
                id: '1f',
                question: 'Hvað táknar tölustafurinn 7 í tölunni 1284,71?',
                options: ['7', '70', '0,7', '0,07'],
                correctAnswer: '0,7',
                explanation: '7 er í fyrsta sæti hægra megin við kommuna (tíundahlutasæti).'
              },
              {
                id: '2a',
                question: 'Hvernig er talan 432 leyst upp eftir sætum?',
                options: ['400 + 30 + 2', '4 + 3 + 2', '40 + 30 + 20', '400 + 32'],
                correctAnswer: '400 + 30 + 2',
                explanation: '4 hundruð, 3 tugir og 2 einingar.'
              },
              {
                id: '2f',
                question: 'Veldu rétta upplausn fyrir töluna 152,75',
                options: [
                    '100 + 50 + 2 + 7 + 5', 
                    '100 + 50 + 2 + 0,7 + 0,05', 
                    '150 + 2 + 0,75', 
                    '1 + 5 + 2 + 7 + 5'
                ],
                correctAnswer: '100 + 50 + 2 + 0,7 + 0,05',
                explanation: 'Hér þarf að passa tugabrotin: 0,7 og 0,05.'
              },
              {
                id: '3a',
                question: 'Skráðu sem eina tölu: 30.000 + 5.000 + 400 + 90 + 2',
                type: 'input',
                correctAnswer: '35492',
                explanation: 'Leggðu saman tölurnar: 35.492.'
              },
              {
                id: '3c',
                question: 'Skráðu sem eina tölu: 4.000.000 + 60.000 + 4.000 + 200 + 5 + 0,6 + 0,08',
                type: 'input',
                correctAnswer: '4064205,68',
                explanation: 'Mundu eftir kommu og að 0 er í hundraðþúsundasæti og tugasæti.'
              }
            ]
          },
          {
            id: 'reikningur',
            title: 'Samlagning og Frádráttur',
            icon: <Icons.Calculator />,
            color: 'bg-emerald-600',
            textColor: 'text-emerald-600',
            bgLight: 'bg-emerald-50',
            borderColor: 'border-emerald-200',
            description: 'Uppstilling, tugabrot og forgangsröðun.',
            questions: [
              {
                id: '12a',
                question: 'Reiknaðu: 4545 + 9837',
                type: 'input',
                correctAnswer: '14382',
                explanation: 'Mundu að geyma þegar summan fer yfir 9 í hverju sæti.'
              },
              {
                id: '12b',
                question: 'Reiknaðu: 595,9 + 936,2',
                type: 'input',
                correctAnswer: '1532,1',
                explanation: 'Passaðu að komman sé beint undir kommunni þegar þú setur dæmið upp.'
              },
              {
                id: '7a',
                question: 'Reiknaðu: 34 - 26',
                type: 'input',
                correctAnswer: '8',
                explanation: 'Hér þarf að fá lánað.'
              },
              {
                id: '17a',
                question: 'Hvað er: 30 - (8 + 7)?',
                options: ['15', '29', '45', '11'],
                correctAnswer: '15',
                explanation: 'Reiknaðu fyrst svigann: 8+7=15. Síðan 30-15=15.'
              },
              {
                id: '18b',
                question: 'Hvað er: 120 - (80 - 45)?',
                options: ['85', '5', '95', '75'],
                correctAnswer: '85',
                explanation: 'Fyrst sviginn: 80-45=35. Svo 120-35=85.'
              }
            ]
          },
          {
            id: 'hitastig',
            title: 'Hitastig og Mínustölur',
            icon: <Icons.Thermometer />,
            color: 'bg-rose-600',
            textColor: 'text-rose-600',
            bgLight: 'bg-rose-50',
            borderColor: 'border-rose-200',
            description: 'Mismunur hitastiga og reikningur með mínus.',
            questions: [
              {
                id: '6a',
                question: 'Hverju munar á 7° og 16°?',
                options: ['9°', '23°', '11°', '8°'],
                correctAnswer: '9°',
                explanation: 'Mismunurinn er 16 - 7 = 9.'
              },
              {
                id: '6b',
                question: 'Hverju munar á -5° og 11°?',
                options: ['16°', '6°', '-6°', '4°'],
                correctAnswer: '16°',
                explanation: 'Frá -5 upp í 0 eru 5 stig. Frá 0 upp í 11 eru 11 stig. Samtals 16 stig.'
              },
              {
                id: '7c',
                question: 'Reiknaðu: -8 + 13',
                type: 'input',
                correctAnswer: '5',
                explanation: 'Ef þú skuldar 8 og átt 13, þá áttu 5 eftir.'
              },
              {
                id: '7e',
                question: 'Reiknaðu: -3 - 3',
                type: 'input',
                correctAnswer: '-6',
                explanation: 'Ef það er -3° og kólnar um 3°, þá verður -6°.'
              },
              {
                id: '8a',
                question: 'Á mánudegi var hiti -5°. Á þriðjudegi var 3 gráðum kaldara. Hver var hitinn á þriðjudegi?',
                options: ['-8°', '-2°', '2°', '8°'],
                correctAnswer: '-8°',
                explanation: '-5 mínus 3 er jafnt og -8.'
              }
            ]
          },
          {
            id: 'ordadaemi',
            title: 'Orðadæmi',
            icon: <Icons.LayoutList />,
            color: 'bg-violet-600',
            textColor: 'text-violet-600',
            bgLight: 'bg-violet-50',
            borderColor: 'border-violet-200',
            description: 'Peningar og hversdagsleg vandamál.',
            questions: [
              {
                id: '15',
                question: 'Nanna á 1150 kr. Hún kaupir stílabók á 340 kr. og tússpenna á 375 kr. Hve mikið á hún eftir?',
                options: ['435 kr.', '715 kr.', '810 kr.', '1865 kr.'],
                correctAnswer: '435 kr.',
                explanation: 'Fyrst: 340+375=715 kr (kostnaður). Svo: 1150-715=435 kr.'
              },
              {
                id: '13a',
                question: 'Sveinn vann 374.830 kr. Jóna vann 403.560 kr. Hve mikið unnu þau samtals?',
                type: 'input',
                correctAnswer: '778390',
                explanation: 'Leggðu saman launin: 374.830 + 403.560.'
              },
              {
                id: '16',
                question: 'Hans á 1300 kr. Hann kaupir vörur fyrir 790 kr. og fær 310 kr. í skilagjald. Hvað á hann mikið?',
                options: ['820 kr.', '200 kr.', '510 kr.', '1610 kr.'],
                correctAnswer: '820 kr.',
                explanation: 'Hann greiðir: 1300 - 790 = 510. Hann fær til baka: 510 + 310 = 820.'
              }
            ]
          }
        ];

        // --- HJÁLPARFÖLL ---
        // Fall til að stokka upp array (Fisher-Yates)
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // --- THE APP ---
        function App() {
          const [activeCategory, setActiveCategory] = useState(null);
          const [questionQueue, setQuestionQueue] = useState([]);
          const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
          const [userAnswer, setUserAnswer] = useState('');
          const [feedback, setFeedback] = useState(null); 
          const [score, setScore] = useState(0);
          const [streak, setStreak] = useState(0);
          const [maxStreak, setMaxStreak] = useState(0);
          const [showSummary, setShowSummary] = useState(false);

          // Reset everything when category changes
          const handleStartCategory = (category) => {
            const shuffledQuestions = shuffleArray(category.questions);
            setQuestionQueue(shuffledQuestions);
            setActiveCategory(category);
            setCurrentQuestionIndex(0);
            setUserAnswer('');
            setFeedback(null);
            setScore(0);
            setStreak(0);
            setShowSummary(false);
          };

          const handleBackToMenu = () => {
            setActiveCategory(null);
          };

          const handleCheckAnswer = () => {
            const currentQ = questionQueue[currentQuestionIndex];
            let isCorrect = false;

            const cleanUser = userAnswer.trim().toLowerCase().replace(/\./g, '').replace('kr', '').trim();
            const cleanCorrect = currentQ.correctAnswer.toLowerCase().replace(/\./g, '').replace('kr', '').trim();
            
            if (currentQ.type === 'input') {
                if (cleanUser === cleanCorrect) isCorrect = true;
                else if (cleanUser.replace(',', '.') === cleanCorrect.replace(',', '.')) isCorrect = true;
            } else {
                if (cleanUser === cleanCorrect) isCorrect = true;
            }

            setFeedback(isCorrect ? 'correct' : 'incorrect');
            
            if (isCorrect) {
                setScore(s => s + 1);
                const newStreak = streak + 1;
                setStreak(newStreak);
                if (newStreak > maxStreak) setMaxStreak(newStreak);
                
                // Smá confetti fyrir high streak
                if (newStreak % 3 === 0) {
                    confetti({
                        particleCount: 50,
                        spread: 60,
                        origin: { y: 0.7 },
                        colors: ['#FFD700', '#FFA500'] // Gull og appelsínugult
                    });
                }
            } else {
                setStreak(0);
            }
          };

          const handleNextQuestion = () => {
            if (currentQuestionIndex < questionQueue.length - 1) {
              setCurrentQuestionIndex(prev => prev + 1);
              setUserAnswer('');
              setFeedback(null);
            } else {
              setShowSummary(true);
              // Stórt confetti þegar búið
              if (score > questionQueue.length / 2) {
                  const duration = 2000;
                  const end = Date.now() + duration;

                  (function frame() {
                    confetti({
                      particleCount: 3,
                      angle: 60,
                      spread: 55,
                      origin: { x: 0 },
                      colors: ['#4ade80', '#3b82f6', '#f43f5e']
                    });
                    confetti({
                      particleCount: 3,
                      angle: 120,
                      spread: 55,
                      origin: { x: 1 },
                      colors: ['#4ade80', '#3b82f6', '#f43f5e']
                    });

                    if (Date.now() < end) {
                      requestAnimationFrame(frame);
                    }
                  }());
              }
            }
          };

          // --- MENU VIEW ---
          if (!activeCategory) {
            return (
              <div className="min-h-screen p-4 md:p-8 animate-pop">
                <header className="mb-12 text-center mt-6">
                  <h1 className="text-4xl md:text-5xl font-extrabold text-slate-800 mb-4 tracking-tight">Stika 3a: Upprifjun</h1>
                  <p className="text-slate-500 text-lg md:text-xl font-medium">1. Kafli: Veldu flokk til að byrja</p>
                </header>

                <div className="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
                  {categories.map((cat) => (
                    <button
                      key={cat.id}
                      onClick={() => handleStartCategory(cat)}
                      className="bg-white p-8 rounded-3xl shadow-sm hover:shadow-xl hover:-translate-y-2 transition-all duration-300 border border-slate-100 flex flex-col items-start text-left group relative overflow-hidden"
                    >
                      <div className={`absolute top-0 right-0 w-32 h-32 ${cat.bgLight} rounded-full -mr-16 -mt-16 transition-transform group-hover:scale-150 duration-500`}></div>
                      
                      <div className={`${cat.color} text-white p-4 rounded-2xl mb-6 shadow-lg relative z-10`}>
                        {cat.icon}
                      </div>
                      
                      <h3 className="text-2xl font-bold text-slate-800 mb-3 relative z-10">{cat.title}</h3>
                      <p className="text-slate-500 text-base mb-8 leading-relaxed relative z-10">{cat.description}</p>
                      
                      <div className={`mt-auto flex items-center ${cat.textColor} font-bold text-base bg-slate-50 px-5 py-3 rounded-xl group-hover:bg-slate-100 transition-colors relative z-10`}>
                        Byrja æfingu <span className="ml-2 group-hover:translate-x-1 transition-transform"><Icons.ChevronRight /></span>
                      </div>
                    </button>
                  ))}
                </div>
              </div>
            );
          }

          const currentQ = questionQueue[currentQuestionIndex];

          // --- SUMMARY VIEW ---
          if (showSummary) {
            const percentage = Math.round((score / questionQueue.length) * 100);
            return (
              <div className="min-h-screen flex items-center justify-center p-4 animate-pop">
                <div className="bg-white max-w-md w-full p-8 rounded-3xl shadow-2xl text-center border border-slate-100 relative overflow-hidden">
                  <div className={`absolute top-0 left-0 w-full h-2 ${activeCategory.color}`}></div>
                  
                  <div className="flex justify-center mb-6 mt-4">
                     {percentage >= 80 ? (
                        <div className="bg-yellow-100 p-6 rounded-full animate-bounce shadow-inner">
                            <span className="text-yellow-600 scale-150 block"><Icons.Award /></span>
                        </div>
                     ) : (
                        <div className="bg-slate-100 p-6 rounded-full">
                            <span className="text-slate-500 block"><Icons.RefreshCcw /></span>
                        </div>
                     )}
                  </div>
                  
                  <h2 className="text-3xl font-black mb-2 text-slate-800">
                    {percentage >= 90 ? 'Frábært!' : percentage >= 50 ? 'Vel gert!' : 'Æfingin skapar meistarann'}
                  </h2>
                  <p className="text-slate-500 mb-8 font-medium">Þú kláraðir {activeCategory.title}</p>
                  
                  <div className="grid grid-cols-2 gap-4 mb-8">
                      <div className="bg-slate-50 p-4 rounded-2xl">
                          <div className="text-sm text-slate-400 font-bold uppercase tracking-wider mb-1">Stig</div>
                          <div className="text-3xl font-black text-slate-800">{score}/{questionQueue.length}</div>
                      </div>
                      <div className="bg-orange-50 p-4 rounded-2xl">
                          <div className="text-sm text-orange-400 font-bold uppercase tracking-wider mb-1">Gullna röðin</div>
                          <div className="text-3xl font-black text-orange-600">{maxStreak}</div>
                      </div>
                  </div>

                  <div className="space-y-3">
                    <button 
                      onClick={() => handleStartCategory(activeCategory)}
                      className={`w-full py-4 ${activeCategory.color} text-white rounded-xl font-bold hover:opacity-90 transition-opacity flex items-center justify-center gap-2 shadow-lg`}
                    >
                      <span className="w-5 h-5"><Icons.RefreshCcw /></span> Prófa aftur
                    </button>
                    <button 
                      onClick={handleBackToMenu}
                      className="w-full py-4 bg-white border-2 border-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-50 transition-colors"
                    >
                      Aftur í valmynd
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          // --- QUESTION VIEW ---
          return (
            <div className="min-h-screen flex flex-col items-center p-4 md:p-6 bg-slate-50">
              
              {/* Top Bar */}
              <div className="w-full max-w-2xl mb-6 flex items-center justify-between">
                <button onClick={handleBackToMenu} className="bg-white p-2 rounded-lg text-slate-400 hover:text-slate-700 shadow-sm border border-slate-200 font-medium text-sm flex items-center transition-colors">
                     Hætta
                </button>
                
                {/* Streak Counter */}
                <div className={`flex items-center gap-2 px-4 py-2 rounded-full font-bold transition-all duration-300 ${streak > 1 ? 'bg-orange-100 text-orange-600' : 'bg-slate-200 text-slate-400'}`}>
                    <span className={streak > 2 ? 'streak-fire' : ''}><Icons.Flame /></span>
                    <span>{streak}</span>
                </div>
              </div>

              {/* Main Card */}
              <div className="w-full max-w-2xl bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-200 animate-pop">
                {/* Progress Bar */}
                <div className="h-2 bg-slate-100 w-full">
                    <div 
                        className={`h-full ${activeCategory.color} transition-all duration-700 ease-out`} 
                        style={{ width: `${((currentQuestionIndex) / questionQueue.length) * 100}%`}}
                    ></div>
                </div>

                <div className="p-6 md:p-10">
                    <div className="flex justify-between items-start mb-6">
                         <span className={`text-xs font-bold tracking-widest uppercase ${activeCategory.textColor} bg-slate-50 px-3 py-1 rounded-md`}>
                            Spurning {currentQuestionIndex + 1}/{questionQueue.length}
                         </span>
                    </div>

                    <h2 className="text-xl md:text-2xl font-bold text-slate-800 mb-8 leading-snug">
                        {currentQ.question}
                    </h2>

                    <div className="mb-8">
                        {currentQ.options ? (
                            <div className="grid grid-cols-1 gap-3">
                                {currentQ.options.map((opt, idx) => (
                                    <button
                                        key={idx}
                                        disabled={feedback !== null}
                                        onClick={() => setUserAnswer(opt)}
                                        className={`p-5 rounded-xl text-left border-2 transition-all font-medium text-lg relative group
                                            ${feedback === null && userAnswer === opt ? `border-current ${activeCategory.textColor} ${activeCategory.bgLight}` : ''}
                                            ${feedback === null && userAnswer !== opt ? 'border-slate-100 hover:border-slate-300 bg-white text-slate-600' : ''}
                                            ${feedback !== null && opt === currentQ.correctAnswer ? 'border-green-500 bg-green-50 text-green-800' : ''}
                                            ${feedback === 'incorrect' && userAnswer === opt && opt !== currentQ.correctAnswer ? 'border-red-500 bg-red-50 text-red-800 opacity-70' : ''}
                                            ${feedback !== null && opt !== currentQ.correctAnswer && opt !== userAnswer ? 'opacity-40 border-slate-100' : ''}
                                        `}
                                    >
                                        <span className="flex items-center justify-between">
                                            {opt}
                                            {feedback === null && userAnswer === opt && <span className="opacity-50 text-sm">Valið</span>}
                                            {feedback !== null && opt === currentQ.correctAnswer && <span className="text-green-600"><Icons.CheckCircle /></span>}
                                        </span>
                                    </button>
                                ))}
                            </div>
                        ) : (
                            <input
                                type="text"
                                value={userAnswer}
                                onChange={(e) => setUserAnswer(e.target.value)}
                                onKeyDown={(e) => e.key === 'Enter' && !feedback && userAnswer && handleCheckAnswer()}
                                placeholder="Skrifaðu svarið hér..."
                                disabled={feedback !== null}
                                className={`w-full p-5 text-xl border-2 rounded-xl outline-none transition-all font-medium
                                    ${feedback === null ? `border-slate-200 focus:border-current focus:${activeCategory.textColor} text-slate-800` : ''}
                                    ${feedback === 'correct' ? 'border-green-500 bg-green-50 text-green-900' : ''}
                                    ${feedback === 'incorrect' ? 'border-red-500 bg-red-50 text-red-900' : ''}
                                `}
                            />
                        )}
                    </div>

                    <div className="min-h-[140px]">
                        {feedback === null ? (
                            <button
                                onClick={handleCheckAnswer}
                                disabled={!userAnswer}
                                className={`w-full py-4 ${activeCategory.color} text-white rounded-xl font-bold text-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-indigo-200/50 transform active:scale-95 duration-200`}
                            >
                                Svara
                            </button>
                        ) : (
                            <div className="animate-pop">
                                <div className={`flex items-start gap-4 p-5 rounded-2xl mb-4 border ${feedback === 'correct' ? 'bg-green-50 border-green-100' : 'bg-red-50 border-red-100'}`}>
                                    <div className="mt-1 shrink-0">
                                        {feedback === 'correct' ? (
                                            <div className="text-green-600 bg-white rounded-full p-1"><Icons.CheckCircle /></div>
                                        ) : (
                                            <div className="text-red-600 bg-white rounded-full p-1"><Icons.XCircle /></div>
                                        )}
                                    </div>
                                    <div>
                                        <h4 className={`font-bold text-lg mb-1 ${feedback === 'correct' ? 'text-green-800' : 'text-red-800'}`}>
                                            {feedback === 'correct' ? 'Rétt svar!' : 'Því miður, ekki rétt.'}
                                        </h4>
                                        <p className="text-slate-600 text-sm leading-relaxed flex gap-2">
                                           <span className="mt-1 opacity-50 shrink-0"><Icons.BookOpen /></span>
                                           <span>{currentQ.explanation}</span>
                                        </p>
                                        {feedback === 'incorrect' && (
                                            <div className="mt-3 inline-block bg-white px-3 py-1 rounded-lg border border-red-100 text-sm font-semibold text-red-700">
                                                Rétt svar: {currentQ.correctAnswer}
                                            </div>
                                        )}
                                    </div>
                                </div>
                                <button
                                    onClick={handleNextQuestion}
                                    autoFocus
                                    className="w-full py-4 bg-slate-900 text-white rounded-xl font-bold text-lg hover:bg-slate-800 transition-colors flex items-center justify-center gap-2 shadow-xl transform active:scale-95 duration-200"
                                >
                                    {currentQuestionIndex < questionQueue.length - 1 ? 'Næsta spurning' : 'Sjá niðurstöður'} 
                                    <span className="w-5 h-5"><Icons.ChevronRight /></span>
                                </button>
                            </div>
                        )}
                    </div>
                </div>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>